# MMD Quick tool 说明文档

##[**帮助文档**](https://bb-yi.github.io/mmd-Quick-tool/#/)

## 前言

`MMD Quick tool` 是一个在 `blender` 中制作 **MMD** 或者其他项目是提高效率的工具,主要为了解决平时遇到的繁琐操作和完善制作流程

`MMD Quick tool`使用`Serpens`插件制作,安装 `Serpens` 插件之后可以打开` github` 的 `blender `文件查看或修改插件的功能

插件由于前期并没有做好规划,什么功能都往里面加,导致现在插件已经变成屎山了,虽然现在有了直接使用代码编写插件的能力,但是想重构功能这么多的一个插件还是需要花费很多精力的,现在也只能继续堆屎山了

## 安装

1.在[Release](https://github.com/bb-yi/mmd-Quick-tool/releases/tag/v1.1.3)页面下载最新版本的插件压缩包  
2.打开 `blender-编辑-偏好设置-插件-从磁盘安装-选择下载的压缩包-安装`,`左下角-保存用户设置`  
3.重启 `blender` 软件

## 功能分类

### 首选项

- **显示设置**
- **查看更新日志**
- **打开 github 首页获取帮助**

### 3D 视图

插件在 3D 视图中添加的功能

#### 标题栏(3D 视图右上角)

- **中英文切换**(快捷键`ctrl+shift+e`)
- **贴图预览模式**(快捷键`ctrl+shift+t`)
- **清理数据** 清理 `blender` 未使用数据,与自带的清理数据一样

#### 主面板

`MMD Quick tool` 的 主面板位于 `MMD` 标签下

#### ik 修复

这一部分是解决 MMD 动作导入时 ik 动作不一致问题的工具

详细流程见[ik 修复](https://www.bilibili.com/video/BV1Za4y1C7rs/?spm_id_from=333.1387.upload.video_card.click)

#### 物体操作

- **位姿归零** 点击后可以复位选中物体的`位置,旋转 缩放`,与 `blender` 自带的复位相比可以`仅复位单个轴向`

#### 临时合并

这个功能是应对多个物体需要合并在一起操作,操作完后再分离的情况,这里的临时合并会**保留原始物体的原点**`(位置,旋转,缩放)`

> **原理:**  
> 合并时会将各个物体保存至顶点组  
> 原点信息保存在新建的矢量属性中

- **合并** 点击后可以将选中的物体合并为一个对象
- **分离** 点击后可以将选中的物体分离为多个对象

#### MMD 工具

##### 名称编辑

- **材质到物体** 将选中物体的名称设置为材质名称
- **物体到材质** 将选中物体的材质名称设置为物体名称
- **贴图到材质** 将选中物体的材质名称设置为贴图名称
  > 贴图名称来源:材质中第一个连接到`Color,Base Color,Diffuse Color,Albedo,Base Tex`接口的贴图名称

##### MMD 流程

- **删除材质变形节点组** 删除选中物体材质中 mmd 自动生成的`变形节点组`
- **合并相同贴图的材质** 合并选中物体使用相同贴图的材质
- **替换 mmd 材质节点组** 替换选中物体的 mmd 材质节点组为原理化 bsdf
- **为 abc 添加材质** 选中 mtl 文件后将自动为 abc 物体添加基础原理化材质,需要贴图与 mtl 文件在同一个文件夹下
- **移除选中物体所有材质** 移除选中物体所有材质
- **为选中物体导入表情** mmd 默认的表情导入只能为一个物体导入表情,这个可以给多个物体批量操作
- **添加自动光圈焦点** 选中一个相机，为这个相机配置`自动对焦和光圈系统`,基于几何节点系统,原理详情见[blender 自动对焦](https://www.bilibili.com/video/BV1tM411K7u4/?spm_id_from=333.1387.upload.video_card.click)

##### 清理

- **清理自定义几何数据** 清理选中物体的自定义几何法向数据(物体数据面板-法向-自定义几何数据),实际上可以多选物体按住 alt 批量清理
- **清理空形态键关键帧** MMD 会将没有使用到的形态键也会打上一个关键帧,这个按钮的作用是删除掉多余的一个关键帧
- **清除形态键上的驱动器** 在 MMD 模型装配完成后,会为所有的形态键打上驱动器(用于在 MMD 面板统一控制),这个按钮的作用是清除掉这些驱动器
- **清除无用材质节点** 将选中物体材质中未使用到的节点删除,可设置迭代深度
- **清楚骨骼修改器** 清除选中物体的骨骼修改器

##### 选择

- **根据贴图选择物体** 在材质编辑器中选择一个贴图节点，就选中相同使用了这张贴图的物体
- **选中相同材质的物体** 选中相同材质的物体
- **选中骨架** 在姿态模式中选中 mmd 常用的骨骼,包括`全部身体骨,身体骨,腿ik骨,手骨,调整骨,d骨,捩骨`
- **按位置选择顶点** 参考编辑模式中选择部分
- **按编号选择顶点** 参考编辑模式中选择部分

##### UV

- **生成位置 UV** 将选中物体的位置保存为 UV,选项`前视图(x,z),左视图(y,z),顶视图(x,y)`
- **移除位置 UV** 移除选中物体生成的位置 UV

##### 顶点色

- **添加顶点色属性** 为选中物体添加顶点色属性,选项`顶点色名称`,默认顶点色为黑色
- **移除顶点色属性** 移除选中物体指定名称的顶点色属性

#### 分段渲染

这是一个比较复杂的功能,实现方式不同于常见的使用 blender 自带渲染 api 的方式,是通过`渲染完成事件`实现的分段渲染,在一个分段渲染完成后会自动停止渲染,设置`起始和结束帧,相机,输出目录`等,继续渲染

- **启用这段任务**-**渲染任务名称**-**渲染起始帧**-**渲染结束帧**-**渲染相机**-**输出目录**

##### 右侧按钮

- **添加任务** 添加一个渲染任务
- **删除任务** 删除一个渲染任务
- **选中任务向上移动** 选中任务向上移动
- **选中任务向下移动** 选中任务向下移动
- **设置时间段** 将当前的起始和结束帧设置为选中任务的起始和结束帧

- **开始渲染** 开始渲染
- **渲染时间信息** 渲染时间信息

#### 其他

##### 饼菜单(快捷键`ctrl+shift+q`)

- **标注** 切换到标注笔
- **清除标注层** 清除标注层
- **标注橡皮擦** 切换到标注橡皮擦
- **添加预览灯光** 添加快速预览灯光
- **框选** 切换到框选模式
- **独立显示** 独立显示选中物体

##### 权重绘制模式

**顶部选项-权重**

- **复制激活骨骼权重到选中骨骼** 复制活动骨骼权重到选中骨骼,选项:`保留目标骨骼的权重`,`移除源骨骼权重`

##### 顶点绘制模式-标题栏左上角

- **为全部顶点涂色**
- **快速替换颜色**

##### 编辑模式-右键

- **原点到选中项** 原点到选中项

##### 顶部选项

**物体-变换**

- **对齐物体到活动项** 将选中物体的变换对齐到活动物体,选项:`位置,旋转,缩放`,`轴向,x,y,z`

**顶点**

- **对称两个顶点** 对称所选的两个顶点,选项:`X轴,Y轴,Z轴`,`对齐方式`

**选择**

- **按位置选择顶点** 按位置选择顶点,选项:`X轴,Y轴,Z轴`,`条件`,`分界`
- **按编号选择顶点** 按编号选择顶点,选项:`编号`,`条件`

### 属性面板

在属性面板中添加的功能

#### 输出 子面板

- ##### 分辨率调整

* **快速设置分辨率** `1920x1080, 2560*1440, 3840*2160, 交换宽高,分辨率*0.5,分辨率*0.75,分辨率*1.5,分辨率*2`
* **快速设置比例** `一看就知道了`

- ##### 相机设置

* **焦距**:激活相机的焦距
* **光圈**:激活相机的光圈

#### 场景 子面板

- ##### 物体组
  可以对集合的显示隐藏 k 帧

> 此功能由于未知 bug,可能导致性能问题,在`1.1.5`版本中移除

#### 修改器 子面板

将常用修改器添加到方框中,方便快速调用

#### 约束 子面板

- **清除所有变换约束** 清除所有变换约束
- **添加位置变换约束** 添加`变换位置`约束,自动填写映射位置范围
- **添加旋转变换约束** 添加`变换旋转`约束,自动填写映射旋转范围

#### 数据 子面板

**形态键-右边下拉小箭头**

- **传递所有形态键** 将形态键复制到激活物体(按编号传递位置)
  > 不记得是什么逻辑了,好像有 bug

### 着色器编辑器

n 面板中添加的功能

#### QT MMD(快速烘焙功能)

##### 烘焙贴图

- **烘焙当前预览** 烘焙当前预览颜色,会烘焙自发光通道,推荐只烘焙纹理,遮罩,不建议烘焙着色器,点击后会在上方生成一张烘焙完成的贴图
- **尺寸** 烘焙贴图的尺寸
- **使用当前选中图像节点** 不创建新的贴图,使用当前选中的贴图烘焙

### 时间线

**标题栏-左侧**

- **显示当前帧的时间** 格式-`分:秒:毫秒+额外帧数`
- **跳转到指定时间** 跳转到指定时间,选项`分`,`秒`

**标题栏-右侧**

- **设置起始帧为当前帧** 设置起始帧为当前帧
- **设置结束帧为当前帧** 设置结束帧为当前帧

### 时间线

**标题栏-左侧**

- **眼睛图标** 独显曲线
